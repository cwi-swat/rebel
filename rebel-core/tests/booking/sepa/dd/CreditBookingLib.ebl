module booking.sepa.dd.CreditBookingLib

import account.payment.BusinessCurrentAccount
import account.process.SepaDirectDebitWashAccount

import DateLib

event create(id: Integer, creditor: IBAN, globalCredit: Money, settlementDate: Date) {
	preconditions {
		globalCredit > EUR 0.00;
		// id should be unique
		initialized BusinessCurrentAccount[creditor];
	}
	postconditions {
		new this.id == id;
		new this.creditor == creditor;
		new this.globalCredit == globalCredit;
		new this.settlementDate == 	nextTarget2Day(settlementDate);
	}
}

event book() {
	sync {
		BusinessCurrentAccount[this.creditor].deposit(this.globalCredit);
		SepaDirectDebitWashAccount[1].withdrawFromWash(this.globalCredit);
	}
}

event fail() {
	sync {
		not BusinessCurrentAccount[this.creditor].deposit(this.globalCredit);
	}
}

event revoke() {
	preconditions {
		beforeTarget2Day(5 Day, this.settlementDate);
	}
}